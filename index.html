<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#37353E" />
    <title>MMA Fight Tracker | Satellite Grounding</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google GenAI Import Map -->
    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.sh/@google/genai@1.40.0"
      }
    }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

        :root {
            --bg-deep: #37353E;
            --bg-card: #44444E;
            --accent: #715A5A;
            --text-main: #D3DAD9;
        }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23D3DAD9' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .brutalist-border {
            border: 2px solid rgba(211, 218, 217, 0.1);
        }

        .brutalist-border:hover {
            border-color: var(--accent);
        }

        .accent-shadow {
            box-shadow: 8px 8px 0px 0px rgba(113, 90, 90, 0.2);
        }

        .loading-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-deep);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }
    </style>
</head>
<body class="overflow-x-hidden min-h-screen pb-20">
    <div id="root">
        <!-- Loader initially shown by the JS -->
        <div class="flex items-center justify-center min-h-screen">
            <div class="text-center">
                <div class="w-16 h-16 border-4 border-[#715A5A] border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                <p class="text-[#715A5A] font-black uppercase tracking-[0.5em] text-[10px] animate-pulse">Initializing Global Feeds...</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenAI, Type } from "@google/genai";

        // --- STATE ---
        const state = {
            events: [],
            loading: true,
            error: null,
            selectedPromotion: null,
        };

        const CACHE_KEY = 'mma_tracker_standalone_v2';
        const CACHE_DURATION = 1000 * 60 * 60 * 3; // 3 Hours

        // --- UTILS ---
        const getManualIST = (isoDateStr) => {
            const date = new Date(isoDateStr);
            if (isNaN(date.getTime())) return { dateString: 'TBA', timeString: 'TBA' };

            const utcTime = date.getTime();
            const istTime = new Date(utcTime + (5.5 * 60 * 60 * 1000));

            const days = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];

            const hours = istTime.getUTCHours();
            const minutes = istTime.getUTCMinutes();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            const displayHours = hours % 12 || 12;
            const displayMinutes = minutes.toString().padStart(2, '0');

            return {
                dateString: `${days[istTime.getUTCDay()]}, ${months[istTime.getUTCMonth()]} ${istTime.getUTCDate()}`,
                timeString: `${displayHours}:${displayMinutes} ${ampm} IST`
            };
        };

        // --- API ---
        const fetchFights = async () => {
            const cached = localStorage.getItem(CACHE_KEY);
            if (cached) {
                const { data, timestamp } = JSON.parse(cached);
                if (Date.now() - timestamp < CACHE_DURATION) return data;
            }

            const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
            const prompt = `SEARCH FOR: Upcoming major MMA events (UFC, PFL, Bellator, ONE Championship, BKFC) for the next 90 days. 
            Exclude past events. Focus on card names, dates (ISO), venues, and major matchups.
            Return JSON array.`;

            try {
                const response = await ai.models.generateContent({
                    model: "gemini-3-flash-preview",
                    contents: prompt,
                    config: {
                        tools: [{ googleSearch: {} }],
                        thinkingConfig: { thinkingBudget: 0 },
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: Type.ARRAY,
                            items: {
                                type: Type.OBJECT,
                                properties: {
                                    promotion: { type: Type.STRING },
                                    eventName: { type: Type.STRING },
                                    date: { type: Type.STRING, description: "ISO format date" },
                                    venue: { type: Type.STRING },
                                    location: { type: Type.STRING },
                                    fightCard: {
                                        type: Type.ARRAY,
                                        items: {
                                            type: Type.OBJECT,
                                            properties: {
                                                fighter1: { type: Type.STRING },
                                                fighter2: { type: Type.STRING },
                                                weightClass: { type: Type.STRING },
                                                isMainEvent: { type: Type.BOOLEAN }
                                            }
                                        }
                                    }
                                },
                                required: ['promotion', 'eventName', 'date', 'fightCard']
                            }
                        }
                    }
                });

                const events = JSON.parse(response.text.trim());
                localStorage.setItem(CACHE_KEY, JSON.stringify({ data: events, timestamp: Date.now() }));
                return events;
            } catch (e) {
                console.error("API Error:", e);
                if (cached) return JSON.parse(cached).data;
                throw e;
            }
        };

        // --- RENDERING ---
        const render = () => {
            const root = document.getElementById('root');
            if (!root) return;

            if (state.loading) {
                root.innerHTML = `
                    <div class="flex flex-col items-center justify-center min-h-screen">
                        <div class="w-16 h-16 border-4 border-[#715A5A] border-t-transparent rounded-full animate-spin mb-6"></div>
                        <p class="text-[#715A5A] font-black uppercase tracking-[0.4em] text-xs animate-pulse">Establishing Satellite Link...</p>
                    </div>`;
                return;
            }

            if (state.error) {
                root.innerHTML = `
                    <div class="flex flex-col items-center justify-center min-h-screen p-10 text-center">
                        <div class="text-6xl mb-6">ðŸ“¡</div>
                        <h2 class="text-2xl font-black italic uppercase mb-2">Sync Error</h2>
                        <p class="text-[#715A5A] font-bold uppercase tracking-widest text-xs mb-8">${state.error}</p>
                        <button onclick="window.initApp()" class="bg-[#715A5A] text-white px-10 py-4 rounded-none font-black uppercase text-xs tracking-[0.3em] hover:bg-[#D3DAD9] hover:text-[#37353E] transition-all accent-shadow">Re-Sync</button>
                    </div>`;
                return;
            }

            const filteredEvents = state.selectedPromotion 
                ? state.events.filter(e => e.promotion === state.selectedPromotion)
                : state.events;

            const promotions = [...new Set(state.events.map(e => e.promotion))].sort();

            root.innerHTML = `
                <header class="bg-[#44444E]/40 backdrop-blur-2xl border-b border-[#D3DAD9]/10 sticky top-0 z-50 p-6">
                    <div class="container mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
                        <div class="flex items-center gap-4">
                            <div class="bg-[#715A5A] w-12 h-12 flex items-center justify-center rotate-3 accent-shadow">
                                <span class="font-black italic text-xl">M</span>
                            </div>
                            <div>
                                <h1 class="text-2xl font-black italic uppercase tracking-tighter leading-none">MMA TRACKER</h1>
                                <p class="text-[9px] text-[#715A5A] font-black uppercase tracking-[0.4em] mt-1">Grounding: Live Satellite Feed</p>
                            </div>
                        </div>

                        <nav class="flex flex-wrap justify-center gap-2">
                            <button onclick="window.selectPromotion(null)" class="px-4 py-2 text-[10px] font-black uppercase tracking-widest ${!state.selectedPromotion ? 'bg-[#D3DAD9] text-[#37353E]' : 'text-[#715A5A] hover:text-[#D3DAD9]'} transition-colors">ALL</button>
                            ${promotions.map(p => `
                                <button onclick="window.selectPromotion('${p}')" class="px-4 py-2 text-[10px] font-black uppercase tracking-widest ${state.selectedPromotion === p ? 'bg-[#D3DAD9] text-[#37353E]' : 'text-[#715A5A] hover:text-[#D3DAD9]'} transition-colors">${p}</button>
                            `).join('')}
                        </nav>
                    </div>
                </header>

                <main class="container mx-auto p-6 md:p-12 max-w-7xl">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                        ${filteredEvents.map(event => renderCard(event)).join('')}
                    </div>
                    ${filteredEvents.length === 0 ? `
                        <div class="text-center py-40">
                            <p class="text-[#715A5A] font-black uppercase tracking-[0.5em] text-sm italic">No upcoming events detected in this sector.</p>
                        </div>
                    ` : ''}
                </main>

                <footer class="fixed bottom-0 left-0 right-0 p-4 bg-[#37353E]/90 backdrop-blur-md border-t border-[#D3DAD9]/5 text-center z-50">
                    <p class="text-[9px] font-black uppercase tracking-[0.6em] text-[#715A5A]">Real-time MMA Synchronization â€¢ Automation.v3 â€¢ Standalone</p>
                </footer>
            `;
        };

        const renderCard = (event) => {
            const ist = getManualIST(event.date);
            return `
                <div class="bg-[#44444E]/40 border-2 border-transparent hover:border-[#715A5A]/50 transition-all p-1 flex flex-col group h-full accent-shadow">
                    <div class="bg-[#37353E] p-4 flex justify-between items-start border-b border-[#D3DAD9]/5">
                        <div class="flex-1 pr-4">
                            <p class="text-[#715A5A] font-black text-[10px] uppercase tracking-widest mb-1">${event.promotion}</p>
                            <h2 class="text-xl font-black italic uppercase tracking-tighter leading-tight group-hover:text-[#715A5A] transition-colors">${event.eventName}</h2>
                        </div>
                        <div class="text-right">
                            <p class="text-lg font-black leading-none">${ist.timeString}</p>
                            <p class="text-[10px] font-bold opacity-40 mt-1">${ist.dateString}</p>
                        </div>
                    </div>

                    <div class="p-6 space-y-4 flex-grow">
                        ${event.fightCard.map((fight, i) => `
                            <div class="relative ${fight.isMainEvent ? 'border-l-4 border-[#715A5A] pl-4' : 'pl-2'}">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-[8px] font-black text-[#715A5A] uppercase tracking-[0.2em]">${fight.weightClass || 'CATCHWEIGHT'}</span>
                                    ${fight.isMainEvent ? '<span class="bg-[#715A5A] text-white text-[8px] font-black px-1.5 py-0.5 italic">MAIN</span>' : ''}
                                </div>
                                <div class="flex items-center justify-between gap-2">
                                    <span class="text-sm font-black uppercase truncate flex-1">${fight.fighter1}</span>
                                    <span class="text-[9px] font-black italic opacity-20">VS</span>
                                    <span class="text-sm font-black uppercase truncate flex-1 text-right">${fight.fighter2}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="p-4 bg-[#37353E]/60 text-[9px] font-black uppercase tracking-widest text-[#715A5A] flex justify-between items-center">
                        <span>${event.venue || 'TBA'}</span>
                        <span class="opacity-40 italic">${event.location || ''}</span>
                    </div>
                </div>
            `;
        };

        // --- GLOBAL ACTIONS ---
        window.selectPromotion = (p) => {
            state.selectedPromotion = p;
            render();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.initApp = async () => {
            try {
                state.loading = true;
                state.error = null;
                render();

                const rawEvents = await fetchFights();
                const now = new Date().getTime();
                
                // Filter and sort
                state.events = rawEvents
                    .filter(e => new Date(e.date).getTime() > (now - 86400000)) // Include today
                    .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());

                state.loading = false;
                render();
            } catch (e) {
                console.error(e);
                state.loading = false;
                state.error = "FEED INTERRUPTED: Could not sync with global fight databases.";
                render();
            }
        };

        // Start
        window.initApp();
    </script>
</body>
</html>